<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Lệnh Sản Xuất</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer></script>
    
    <style>
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.3s; }
        .spinner { border: 8px solid #f3f3f3; border-top: 8px solid #3498db; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { opacity: 0; pointer-events: none; }
        .demo-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg); font-size: 8vw; line-height: 1.1; color: rgba(255, 0, 0, 0.08); font-weight: bold; text-transform: uppercase; text-align: center; z-index: 1; pointer-events: none; }
        @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: white !important; margin: 0 !important; padding: 0 !important; overflow: hidden; } .no-print, #loading-overlay, .demo-watermark { display: none !important; } .bill-container { margin: 0 !important; padding: 0 !important; box-shadow: none !important; width: 100% !important; max-width: 100% !important; border: none !important; page-break-inside: avoid; } @page { size: A4 portrait; margin: 8mm; } * { page-break-before: avoid; page-break-after: avoid; } }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #eee; font-family: 'Times New Roman', Times, serif; }
        .bill-container { background: white; color: #000; position: relative; visibility: hidden; display: flex; flex-direction: column; margin: 20px auto; max-width: 190mm; min-height: 270mm; padding: 10pt; box-shadow: 0 0 10px rgba(0,0,0,0.1); font-size: 10pt; }
        .print-options { position: fixed; top: 10px; right: 10px; background: #f0f0f0; padding: 10px; border: 1px solid #ccc; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 8px; }
        .print-options button { margin: 0; padding: 8px 12px; height: 44px; cursor: pointer; border: none; border-radius: 5px; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.2s ease-in-out; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; gap: 8px; }
        .company-header { display: flex; align-items: center; justify-content: space-between; gap: 15px; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 8px;}
        .footer { padding-top: 10px; margin-top: auto; }
        .signature-section { display: flex; justify-content: space-around; text-align: center; page-break-inside: avoid; margin-top: 0; }
        .logo { max-width: 100px; height: auto; flex-shrink: 0; } 
        .header-title-block { text-align: center; flex-grow: 1; }
        .main-title { font-size: 2.2em; font-weight: bold; line-height: 1.1; text-transform: uppercase; }
        .order-info-line { display: flex; justify-content: center; gap: 20px; margin-top: 5px; font-size: 0.9em; }
        #order-qrcode { flex-shrink: 0; }
        #order-qrcode img { width: 80px; height: 80px; }
        .section { border: 1px solid #ccc; padding: 8px; margin-bottom: 8px; border-radius: 4px; }
        .section-title { font-weight: bold; font-size: 1.2em; background-color: #f2f2f2; padding: 4px 8px; margin: -8px -8px 8px -8px; border-bottom: 1px solid #ccc; border-radius: 4px 4px 0 0; }
        .grid-container { display: grid; gap: 4px 12px; }
        .grid-2-col { grid-template-columns: repeat(2, 1fr); }
        .grid-3-col { grid-template-columns: repeat(3, 1fr); }
        .info-item { display: flex; flex-wrap: wrap; align-items: baseline; }
        .info-item label { font-weight: bold; margin-right: 5px; white-space: nowrap; }
        .info-item span { border-bottom: 1px dotted #888; flex-grow: 1; min-width: 80px; }
        .full-width { grid-column: 1 / -1; }
        .spec-table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 9.5pt; }
        .spec-table th, .spec-table td { border: 1px solid #999; padding: 4px; text-align: left; vertical-align: top; }
        .spec-table th { background-color: #f2f2f2; font-weight: bold; text-align: center; }
        .spec-table td.center { text-align: center; }
        .text-bold { font-weight: bold; }
        .merged-section-layout { display: flex; gap: 15px; align-items: flex-start; }
        .merged-section-layout .text-content { flex: 2; display: flex; flex-direction: column; gap: 10px;}
        .merged-section-layout .image-content { flex: 1; }
        .info-block { display: flex; flex-direction: column; gap: 4px; }
        #artwork-image-container { width: 100%; aspect-ratio: 4 / 3; border: 1px solid #ccc; padding: 5px; display: flex; justify-content: center; align-items: center; background-color: #f9f9f9;}
        #artwork-image-container img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .signature-box { width: 40%; }
        .signature-box .signature-title { font-weight: bold; }
        .signature-box .signature-name { margin-top: 60px; font-weight: bold; }
    </style>
</head>
<body class="format-a4">
    <div id="loading-overlay"><div class="spinner"></div></div>
    <div class="print-options no-print"><button class="btn-print" onclick="window.print()" title="In Phiếu"><svg viewBox="0 0 24 24" width="24" height="24" fill="white"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/></svg></button><button class="btn-pdf" onclick="downloadPDF()" title="Tải về file PDF"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1m-1 4v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 11.293V7.5a.5.5 0 0 1 1 0"/></svg></button></div>

    <div class="bill-container" id="bill-container">
        <!-- HEADER -->
        <div class="company-header"><img id="logo-img" src="https://scontent.fsgn5-12.fna.fbcdn.net/v/t1.6435-9/90417587_101537181496969_1126778176115048448_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=i78ZM_nEKuUQ7kNvwHHfkCD&nc_oc=AdnJdasev9zMhHc6ELnEipIG6JFdhpW4HaMw0JPviIYxYXUQz8_Km6_azPRq-6KLN-AS92o4a9QQ5hx8WnGow6WR&_nc_zt=23&_nc_ht=scontent.fsgn5-12.fna&_nc_gid=TrGqWXWdJMMBEEwPYgKHtQ&oh=00_AfVRthaEuicfyGt0-D_0KheC0uskcmHmLiIvYhgnUFim5Q&oe=68C20A1E" alt="Logo" class="logo" crossorigin="anonymous"><div class="header-title-block"><div class="main-title">Lệnh Sản Xuất</div><div class="order-info-line"><span><strong>Lệnh SX:</strong> <span id="lenh_sx" class="text-bold"></span></span><span><strong>Ngày tạo:</strong> <span id="ngay_tao_lenh"></span></span><span><strong>Loại đơn:</strong> <span id="loai_don"></span></span></div></div><div id="order-qrcode"></div></div>

        <!-- BODY -->
        <div class="invoice-body">
            <div class="section"><div class="section-title">A. THÔNG TIN ĐƠN HÀNG & BÌNH BÀI</div><div class="merged-section-layout"><div class="text-content"><div class="info-block" id="customer-order-info"><div class="info-item"><label>Khách hàng:</label><span id="khach_hang"></span></div><div class="info-item"><label>Số ĐH:</label><span id="so_dh"></span></div></div><div class="info-block" id="artwork-info"><div class="grid-container grid-2-col"><div class="info-item"><label>Mã bài bình:</label><span id="ma_bai_binh"></span></div><div class="info-item"><label>Khổ bài bình:</label><span id="kho_bai_binh"></span></div><div class="info-item"><label>Tổng số SP/tờ:</label><span id="tong_so_sp_to"></span></div><div class="info-item"><label>Tổng SL:</label><span id="sl_tong" class="text-bold"></span></div></div><div class="info-item"><label>Quy trình sản xuất:</label><span id="quy_trinh_san_xuat"></span></div><div class="info-item"><label>Ghi chú bình bài:</label><span id="ghi_chu_binh_bai"></span></div></div></div><div class="image-content"><div id="artwork-image-container"></div></div></div></div>
            <div class="section"><div class="section-title">B. THÔNG TIN SẢN PHẨM</div><table class="spec-table"><thead><tr><th style="width:5%">STT</th><th>Sản phẩm (Mã - Tên)</th><th style="width:8%">ĐVT</th><th style="width:10%">Số Lượng</th><th style="width:25%">Ghi Chú</th></tr></thead><tbody id="product-table-body"></tbody></table></div>
            <div class="section"><div class="section-title">C. CHI TIẾT VẬT TƯ & IN ẤN</div><table class="spec-table"><thead><tr><th>Hạng mục</th><th>Loại / Mã VT</th><th>Khổ mua (cm)</th><th>SL Cần (Tờ)</th><th>Khổ in</th><th>Kiểu / Màu in</th><th>Ghi chú</th></tr></thead><tbody><tr><td class="text-bold">Giấy Bìa</td><td><span id="loai_giay_bia"></span> / <span id="ma_giay_bia"></span></td><td class="center"><span id="kho_giay_bia_mua"></span></td><td class="center text-bold"><span id="sl_giay_bia_can_to"></span></td><td class="center"><span id="kho_in_bia"></span></td><td class="center"><span id="kieu_in_bia"></span> / <span id="so_mau_in_bia"></span></td><td><span id="ghi_chu_giay_bia"></span></td></tr><tr><td class="text-bold">Giấy Ruột</td><td><span id="loai_giay_ruot"></span> / <span id="ma_giay_ruot"></span></td><td class="center"><span id="kho_giay_ruot_mua"></span></td><td class="center text-bold"><span id="sl_giay_ruot_can_to"></span></td><td class="center"><span id="kho_in_ruot"></span></td><td class="center"><span id="kieu_in_ruot"></span> / <span id="so_mau_in_ruot"></span></td><td><span id="ghi_chu_giay_ruot"></span></td></tr><tr><td class="text-bold">Giấy Bồi</td><td><span id="loai_giay_boi"></span> / <span id="ma_giay_boi"></span></td><td class="center"><span id="kho_giay_boi_mua_dxr_cm"></span></td><td class="center text-bold"><span id="sl_giay_boi_can_to"></span></td><td class="center">-</td><td class="center">-</td><td><span id="ghi_chu_giay_boi"></span></td></tr><tr><td class="text-bold">Kẽm</td><td colspan="3" class="center"><span id="kho_kem"></span></td><td colspan="3"><span id="ghi_chu_kem"></span></td></tr></tbody></table></div>
            <div class="section"><div class="section-title">D. THÀNH PHẨM & GIAO HÀNG</div><div class="grid-container grid-3-col"><div class="info-item"><label>Cán màng:</label><span><span id="ma_mang"></span> / <span id="kho_mang"></span>cm / <span id="sl_mang_m"></span>m</span></div><div class="info-item"><label>Ép kim:</label><span>DT: <span id="dien_tich_ep_kim"></span>cm², Mã nhũ: <span id="ma_nhu"></span></span></div><div class="info-item"><label>Tráng phủ:</label><span id="trang_phu"></span></div><div class="info-item"><label>Chiết quang:</label><span id="chiet_quang"></span></div><div class="info-item"><label>Bồi:</label><span id="boi"></span></div><div class="info-item"><label>Bế nổi:</label><span id="be_noi"></span></div><div class="info-item"><label>Kiểu bế:</label><span id="kieu_be"></span></div><div class="info-item"><label>Khuôn bế:</label><span><span id="so_khuon_be"></span> khuôn (<span id="khuon_be"></span>)</span></div><div class="info-item"><label>Số con/khuôn:</label><span id="so_con_khuon"></span></div><div class="info-item"><label>Xé:</label><span id="xe"></span></div><div class="info-item"><label>Dán:</label><span id="dan"></span></div><div class="info-item"><label>Cắt TP:</label><span id="cat_thanh_pham"></span></div><div class="info-item"><label>SL Thành Phẩm:</label><span id="sl_thanh_pham" class="text-bold"></span></div><div class="info-item"><label>SL Đã Giao:</label><span id="sl_da_giao"></span></div><div class="info-item"><label>Ngày Hoàn Tất:</label><span id="ngay_hoan_tat"></span></div></div><div class="info-item full-width" style="margin-top: 5px;"><label>TP Khác:</label><span id="thanh_pham_khac"></span></div><div class="info-item full-width"><label>Ghi chú TP:</label><span id="ghi_chu_thanh_pham"></span></div><div class="info-item full-width"><label>Ghi chú Giao Hàng:</label><span id="ghi_chu_giao_hang"></span></div><div class="info-item full-width"><label>Ghi chú Chung:</label><span id="ghi_chu"></span></div></div>
        </div>

        <!-- FOOTER -->
        <div class="footer"><div class="signature-section"><div class="signature-box"><div class="signature-title">Người Lập Phiếu</div><div class="signature-name" id="nguoi_lap_phieu"></div></div><div class="signature-box"><div class="signature-title">Người Duyệt</div><div class="signature-name" id="nguoi_duyet"></div></div></div></div>
    </div>
    
    <script>
        async function convertImageToBase64(imgElement) { if (!imgElement || !imgElement.src || imgElement.src.startsWith('data:image')) return; const originalSrc = imgElement.src; try { const response = await fetch(originalSrc, { cache: 'force-cache' }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const blob = await response.blob(); return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onloadend = () => { imgElement.src = reader.result; resolve(true); }; reader.onerror = reject; reader.readAsDataURL(blob); }); } catch (error) { console.error(`Failed to fetch or convert image: ${originalSrc}`, error); return false; } }
        async function downloadPDF() { const loader = document.getElementById('loading-overlay'); loader.classList.remove('hidden'); const element = document.querySelector('.bill-container'); const printOptionsPanel = document.querySelector('.print-options'); const orderId = document.getElementById('lenh_sx').textContent || 'unknown'; const filename = `LSX-${orderId}.pdf`; printOptionsPanel.style.display = 'none'; const allImages = Array.from(document.querySelectorAll('#logo-img, #order-qrcode img, #artwork-image-container img')); await Promise.all(allImages.map(img => convertImageToBase64(img))); const jspdfConfig = { unit: 'mm', format: 'a4', orientation: 'portrait' }; const opt = { margin: [10, 8, 10, 8], filename: filename, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 3, useCORS: true, logging: false }, jsPDF: jspdfConfig }; try { await html2pdf().from(element).set(opt).save(); } catch (error) { console.error("Error creating PDF:", error); } finally { printOptionsPanel.style.display = 'flex'; loader.classList.add('hidden'); } }
        function getUrlParameter(name) { return decodeURIComponent((new URLSearchParams(window.location.search).get(name) || '').replace(/\+/g, ' ')); }
        function displayImage(containerId, imageUrl, altText = 'Image') { const container = document.getElementById(containerId); if (container && imageUrl) { const img = new Image(); img.crossOrigin = 'anonymous'; img.src = imageUrl; img.alt = altText; container.innerHTML = ''; container.appendChild(img); } else if (container) { container.innerHTML = '<i>Không có hình ảnh</i>'; } }
        function renderProductsTable(productsJSON) { const tableBody = document.getElementById('product-table-body'); tableBody.innerHTML = ''; if (!productsJSON) { tableBody.innerHTML = '<tr><td colspan="5" class="center"><em>Không có thông tin sản phẩm.</em></td></tr>'; return; } try { const products = JSON.parse(productsJSON); if (Array.isArray(products) && products.length > 0) { products.forEach((p, index) => { const row = document.createElement('tr'); row.innerHTML = `<td class="center">${index + 1}</td><td>${p.masp || ''}</td><td class="center">${p.dvt || ''}</td><td class="center text-bold">${p.soluong || ''}</td><td>${p.ghi_chu || ''}</td>`; tableBody.appendChild(row); }); } else { throw new Error("JSON is not a non-empty array."); } } catch (error) { console.error("Error parsing products JSON:", error, "Received JSON:", productsJSON); tableBody.innerHTML = `<tr><td colspan="5" class="center"><em>Lỗi đọc dữ liệu sản phẩm.</em></td></tr>`; } }
        function populateProductionOrder(data) { const setText = (id, value) => { document.getElementById(id).textContent = value || ''; }; setText('lenh_sx', data.lenh_sx); if (data.ngay_tao_lenh) { setText('ngay_tao_lenh', new Date(data.ngay_tao_lenh).toLocaleDateString('vi-VN')); } setText('loai_don', data.loai_don); setText('khach_hang', data.ten_khach_hang); setText('so_dh', data.so_dh); setText('quy_trinh_san_xuat', data.quy_trinh_san_xuat); setText('ma_bai_binh', data.ma_bai_binh); setText('kho_bai_binh', data.kho_bai_binh); setText('tong_so_sp_to', data.tong_so_sp_to); setText('sl_tong', data.sl_tong); setText('ghi_chu_binh_bai', data.ghi_chu_binh_bai); setText('loai_giay_bia', data.loai_giay_bia); setText('ma_giay_bia', data.ma_giay_bia); setText('kho_giay_bia_mua', data.kho_giay_bia_mua); setText('sl_giay_bia_can_to', data.sl_giay_bia_can_to); setText('kho_in_bia', data.kho_in_bia); setText('kieu_in_bia', data.kieu_in_bia); setText('so_mau_in_bia', data.so_mau_in_bia); setText('ghi_chu_giay_bia', data.ghi_chu_giay_bia); setText('loai_giay_ruot', data.loai_giay_ruot); setText('ma_giay_ruot', data.ma_giay_ruot); setText('kho_giay_ruot_mua', data.kho_giay_ruot_mua); setText('sl_giay_ruot_can_to', data.sl_giay_ruot_can_to); setText('kho_in_ruot', data.kho_in_ruot); setText('kieu_in_ruot', data.kieu_in_ruot); setText('so_mau_in_ruot', data.so_mau_in_ruot); setText('ghi_chu_giay_ruot', data.ghi_chu_giay_ruot); setText('loai_giay_boi', data.loai_giay_boi); setText('ma_giay_boi', data.ma_giay_boi); setText('kho_giay_boi_mua_dxr_cm', data.kho_giay_boi_mua_dxr_cm); setText('sl_giay_boi_can_to', data.sl_giay_boi_can_to); setText('ghi_chu_giay_boi', data.ghi_chu_giay_boi); setText('kho_kem', data.kho_kem); setText('ghi_chu_kem', data.ghi_chu_kem); setText('ma_mang', data.ma_mang); setText('kho_mang', data.kho_mang); setText('sl_mang_m', data.sl_mang_m); setText('dien_tich_ep_kim', data.dien_tich_ep_kim); setText('ma_nhu', data.ma_nhu); setText('trang_phu', data.trang_phu); setText('chiet_quang', data.chiet_quang); setText('boi', data.boi); setText('kieu_be', data.kieu_be); setText('so_khuon_be', data.so_khuon_be); setText('khuon_be', data.khuon_be); setText('so_con_khuon', data.so_con_khuon); setText('be_noi', data.be_noi); setText('xe', data.xe); setText('dan', data.dan); setText('cat_thanh_pham', data.cat_thanh_pham); setText('thanh_pham_khac', data.thanh_pham_khac); setText('ghi_chu_thanh_pham', data.ghi_chu_thanh_pham); setText('sl_thanh_pham', data.sl_thanh_pham); setText('sl_da_giao', data.sl_da_giao); if (data.ngay_hoan_tat) { setText('ngay_hoan_tat', new Date(data.ngay_hoan_tat).toLocaleDateString('vi-VN')); } setText('ghi_chu_giao_hang', data.ghi_chu_giao_hang); setText('ghi_chu', data.ghi_chu); setText('nguoi_lap_phieu', data.nguoi_lap_phieu); setText('nguoi_duyet', data.nguoi_duyet); renderProductsTable(data.products_json); displayImage('order-qrcode', data.qr_code ? data.qr_code.replace(/=s\d+$/, '=s256') : '', 'QR Code'); const fallbackArtworkUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://boxprintingcompany.com/Technical-Supports/images/Why-need-the-Box-Design.jpg'); const finalArtworkUrl = data.hinh_bai_binh_1 || data.file_in || fallbackArtworkUrl; displayImage('artwork-image-container', finalArtworkUrl, 'Hình bài bình'); }
        function loadDataFromUrl() { const data = {}; const fields = ['lenh_sx','ngay_tao_lenh','loai_don','ma_bai_binh','ten_khach_hang','so_dh','quy_trinh_san_xuat','sl_tong','kho_bai_binh','tong_so_sp_to','hinh_bai_binh_1','ghi_chu_binh_bai','loai_giay_bia','ma_giay_bia','kho_giay_bia_mua','sl_giay_bia_can_to','kho_in_bia','kieu_in_bia','so_mau_in_bia','ghi_chu_giay_bia','loai_giay_ruot','ma_giay_ruot','kho_giay_ruot_mua','sl_giay_ruot_can_to','kho_in_ruot','kieu_in_ruot','so_mau_in_ruot','ghi_chu_giay_ruot','kho_kem','ghi_chu_kem','loai_giay_boi','ma_giay_boi','kho_giay_boi_mua_dxr_cm','sl_giay_boi_can_to','ghi_chu_giay_boi','ma_mang','kho_mang','sl_mang_m','trang_phu','dien_tich_ep_kim','ma_nhu','chiet_quang','boi','kieu_be','so_khuon_be','khuon_be','so_con_khuon','be_noi','xe','dan','cat_thanh_pham','thanh_pham_khac','ghi_chu_thanh_pham','sl_thanh_pham','sl_da_giao','ngay_hoan_tat','ghi_chu_giao_hang','ghi_chu','qr_code','nguoi_lap_phieu','nguoi_duyet', 'products_json']; fields.forEach(field => data[field] = getUrlParameter(field)); populateProductionOrder(data); }
        function loadDemoData() { const demoProducts = [ { "masp": "SP001 - Hộp quà tặng cao cấp", "dvt": "Cái", "soluong": "3000", "ghi_chu": "Màu đỏ cờ, logo ép kim" }, { "masp": "SP002 - Túi giấy đựng sản phẩm", "dvt": "Cái", "soluong": "2000", "ghi_chu": "Dây dù màu trắng" }, { "masp": "SP003 - Tem nhãn decal", "dvt": "Con", "soluong": "5500", "ghi_chu": "Bế tròn, cán màng bóng" } ]; const demoData = {lenh_sx: 'LSX-DEMO-001', ngay_tao_lenh: '2024-07-25', loai_don: 'Sản xuất mới',ma_bai_binh: 'BB-HOP-055', ten_khach_hang: 'CÔNG TY TNHH THƯƠNG MẠI DỊCH VỤ SQH',so_dh: 'DH-240720-01, DH-240720-02', quy_trinh_san_xuat: 'In Offset -> Cán Màng -> Bế -> Dán thành phẩm', sl_tong: '5500', kho_bai_binh: '79x54 cm', tong_so_sp_to: '4',hinh_bai_binh_1: '', ghi_chu_binh_bai: 'Canh màu theo mẫu duyệt ngày 24/07. Chú ý các chi tiết nhỏ.',loai_giay_bia: 'Ivory', ma_giay_bia: 'IVY-350', kho_giay_bia_mua: '79x109', sl_giay_bia_can_to: '1300',kho_in_bia: '72x102', kieu_in_bia: 'Offset', so_mau_in_bia: '4 màu CMYK', ghi_chu_giay_bia: 'Nhập kho ngày 20/07',loai_giay_ruot: 'Ford', ma_giay_ruot: 'FORD-80', kho_giay_ruot_mua: '65x86', sl_giay_ruot_can_to: '2500',kho_in_ruot: '60x84', kieu_in_ruot: 'Offset', so_mau_in_ruot: '1 màu (Đen)', ghi_chu_giay_ruot: 'Giấy có sẵn trong kho',kho_kem: '1030*770*0.3', ghi_chu_kem: 'Xuất 5 tấm kẽm mới',loai_giay_boi: 'Carton', ma_giay_boi: 'CAR-1200', kho_giay_boi_mua_dxr_cm: '79x109', sl_giay_boi_can_to: '1250',ghi_chu_giay_boi: 'Kiểm tra độ phẳng của giấy', ma_mang: 'Màng mờ', kho_mang: '75', sl_mang_m: '1500',trang_phu: 'UV định hình logo', dien_tich_ep_kim: '25', ma_nhu: 'Vàng gold 12',chiet_quang: 'Không', boi: 'Bồi lên carton 2mm', kieu_be: 'Bế gân, bế đứt',so_khuon_be: '1', khuon_be: 'Khuôn có sẵn (Mã K-021)', so_con_khuon: '4',be_noi: 'Có', xe: 'Có', dan: 'Dán máy tự động', cat_thanh_pham: 'Cắt xén 4 cạnh',thanh_pham_khac: 'Gắn nam châm hít', ghi_chu_thanh_pham: 'Kiểm tra lực hít của nam châm',sl_thanh_pham: '5000', sl_da_giao: '0', ngay_hoan_tat: '2024-08-15',ghi_chu_giao_hang: 'Giao làm 2 đợt, mỗi đợt 2500 cái.', ghi_chu: 'Ưu tiên sản xuất gấp.', qr_code: 'https://quickchart.io/qr?text=LSX-DEMO-001&size=128',nguoi_lap_phieu: 'Nguyễn Thị An (KHSX)', nguoi_duyet: 'Trần Văn Bình (Trưởng phòng SX)', products_json: JSON.stringify(demoProducts) }; populateProductionOrder(demoData); const watermark = document.createElement('div'); watermark.className = 'demo-watermark'; watermark.innerHTML = 'LỆNH NHÁP'; document.getElementById('bill-container').appendChild(watermark); }
        function initializeApp() { const loader = document.getElementById('loading-overlay'); const container = document.getElementById('bill-container'); try { if (window.location.search.length > 1) { loadDataFromUrl(); } else { loadDemoData(); } container.style.visibility = 'visible'; loader.classList.add('hidden'); } catch (error) { console.error("Failed to initialize:", error); loader.innerHTML = `<h1>Lỗi tải phiếu</h1><p>${error.message}</p>`; } }
        document.addEventListener('DOMContentLoaded', () => { initializeApp(); });
    </script>
</body>
</html>
